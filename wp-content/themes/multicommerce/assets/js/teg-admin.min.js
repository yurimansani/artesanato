/*!
 * Custom JS for custom image uploading
 * @package ThemeEgg
 * @subpackage MultiCommerce
 */
!function(u){"use strict";var l,p=u(document);(l={Repeater:function(){var g=function(e){e.find("[name]").each(function(){u(this).trigger("change")})},i=function(){var e=u(".te-repeater");e.sortable({orientation:"vertical",items:"> .repeater-table",placeholder:"te-sortable-placeholder",update:function(e,t){g(t.item)}}),e.trigger("sortupdate"),e.sortable("refresh")};p.on("widget-added widget-updated panelsopen",function(e,t){i()}),u(function(){"widgets"===window.pagenow&&u(".widgets-holder-wrap:not(#available-widgets)").find("div.widget").one("click.toggle-widget-expanded",function(){i()})}),p.on("click",".te-add-repeater",function(e){e.preventDefault();var t=u(this),i=t.closest(".te-repeater"),n=i.find(".te-code-for-repeater"),a=i.find(".te-total-repeater"),o=parseInt(a.val()),r=n.html();a.val(o+1);var s,c,d,l,p=(s=r,c=t.attr("id"),d=o,l=new RegExp(c,"g"),s.replace(l,d));t.before(u('<div class="repeater-table"></div>').append(p));var f=t.prev(".repeater-table");f.find(".te-repeater-inside").slideDown("fast",function(){f.addClass("open"),g(f)})}),p.on("click",".te-repeater-top, .te-repeater-close",function(e){e.preventDefault();var t=u(this).closest(".repeater-table"),i=t.find(".te-repeater-inside");i.is(":hidden")?i.slideDown("fast",function(){t.addClass("open")}):i.slideUp("fast",function(){t.removeClass("open")})}),p.on("click",".te-repeater-remove",function(e){e.preventDefault();var t=u(this),i=t.closest(".repeater-table"),n=t.closest(".te-repeater");i.remove(),n.closest("form").trigger("change"),g(n)}),p.on("change",".te-select",function(e){e.preventDefault();var t=u(this),i=t.closest(".te-repeater-inside"),n=i.find(".te-postid"),a=i.find(".te-repeater-control-actions"),o=t.find("option:selected").val();0==o?n.remove():(n.remove(),u.ajax({type:"GET",data:{action:"teg_get_edit_post_link",id:o},url:ajaxurl,beforeSend:function(e,t){n.remove()},success:function(e){0!=e&&a.append(e)},error:function(e,t,i){console.log(e+" :: "+t+" :: "+i)}}))})},Snipits:{Variables:function(){u(window).width(),u(window).height()},Append_HTML:function(){if("undefined"!=typeof teg_theme_info_object){var e=teg_theme_info_object.count_actions_recommended;void 0!==e&&"0"!=e&&u("li.multicommerce-info-w-red-tab a").append('<span class="multicommerce-info-actions-count">'+e+"</span>")}},Color_Picker:function(i){var e={change:function(e,t){i.closest("form").trigger("change")}};i.wpColorPicker(e)},ImageUpload:function(e){e.preventDefault();var t=u(this).data("title"),i=u(this).data("button"),n=u(this).prev(),a=u(this).prev().prev().children("img"),o=u(this).siblings(".img-preview-wrap"),r=wp.media.frames.meta_image_frame=wp.media({title:t,button:{text:i},library:{type:"image"}});r.open(),r.on("select",function(){var e=r.state().get("selection").first().toJSON();n.val(e.url),null!=a&&(a.attr("src",e.url),o.show()),n.trigger("change")})},WidgetTab:function(e){var t,i;u(this).hasClass("nav-tab-active")||(i=u(this).data("id"),t=u(this).closest(".multicommerce-tab-wraper"),u(this).addClass("nav-tab-active").siblings(".nav-tab").removeClass("nav-tab-active"),t.find(".multicommerce-tab-content").removeClass("multicommerce-content-active"),t.find(i).addClass("multicommerce-content-active"))},Widget_Accordion:function(){var e=u(this).closest(".teg-accordion-title");u(this).prop("checked")?(e.siblings(".teg-accordion-content").slideDown().removeClass("open close"),e.find(".teg-accordion-arrow").addClass("fa-angle-up").removeClass("fa-angle-down")):(e.siblings(".teg-accordion-content").slideUp().removeClass("open close"),e.find(".teg-accordion-arrow").addClass("fa-angle-down").removeClass("fa-angle-up"))},Widget_Relation:function(e){var t=u(this),i=t.val(),n=u(this).data("relations");if(n)for(var a in i=t.is(":checkbox")&&t.is(":checked")?i:0,n)if(a==i||"!"==i){var o=n[a];for(var r in o){var s="."+o[r].join(", .");switch(r){case"show_fields":t.closest(".widget-content").find(s).removeClass("teg_hidden_field");break;case"hide_fields":t.closest(".widget-content").find(s).addClass("teg_hidden_field");break;default:console.warn(a+" case is not defined")}}}},CustomizerIcons:function(){var e=u(this),t=e.closest(".te-icons-wrapper"),i=e.children("i").attr("class"),n=i.split(" ")[1];e.siblings().removeClass("selected"),e.addClass("selected"),t.find(".te-icon-value").val(n),t.find(".icon-preview").html('<i class="'+i+'"></i>'),t.find(".te-icon-value").trigger("change")},IconToggle:function(){var e=u(this).closest(".te-icons-wrapper"),t=e.find(".icons-list-wrapper"),i=e.find(".dashicons");t.is(":hidden")?(t.slideDown(),i.removeClass("dashicons-arrow-down"),i.addClass("dashicons-arrow-up")):(t.slideUp(),i.addClass("dashicons-arrow-down"),i.removeClass("dashicons-arrow-up"))},IconSearch:function(){var e=u(this),t=this.value;e.closest(".te-icons-wrapper").find(".icons-list-wrapper").find("i").each(function(){-1<u(this).attr("class").search(t)?u(this).parent(".single-icon").show():u(this).parent(".single-icon").hide()})},DismissRequiredActions:function(){var e=u(this).attr("id"),t=u(this).attr("data-action");u.ajax({type:"GET",data:{action:"teg_theme_info_update_recommended_action",id:e,todo:t},dataType:"html",url:teg_theme_info_object.ajaxurl,beforeSend:function(e,t){u(".multicommerce-info-tab-pane#actions_required h1").append('<div id="temp_load" style="text-align:center"><img src="'+teg_theme_info_object.template_directory+'/inc/multicommerce-info/images/ajax-loader.gif" /></div>')},success:function(e){location.reload(),u("#temp_load").remove()},error:function(e,t,i){console.log(e+" :: "+t+" :: "+i)}})},Widget_Change:function(e,t){var i=l.Snipits,n=u(t);n.find(".teg_widget_relations").trigger("change"),i.Color_Picker(n.find(".multicommerce-color-picker")),n.hasClass("widget-dirty")&&(n.removeClass("widget-dirty"),n.find('input[type="submit"]').attr("disabled","disabled"))}},Click:function(){var e=l.Snipits,t=e.ImageUpload;p.on("click",".media-image-upload",t);var i=e.WidgetTab;p.on("click",".multicommerce-tab-list .nav-tab",i);var n=e.Widget_Relation;u(document).on("change",".teg_widget_relations",n),u(".teg_widget_relations").trigger("change"),p.on("click",".media-image-remove",function(e){u(this).siblings(".img-preview-wrap").hide(),u(this).prev().prev().val("")});var a=e.CustomizerIcons;p.on("click",".te-icons-wrapper .single-icon",a);var o=e.IconToggle;p.on("click",".te-icons-wrapper .icon-toggle ,.te-icons-wrapper .icon-preview",o);var r=e.IconSearch;p.on("keyup",".te-icons-wrapper .icon-search",r);var s=e.DismissRequiredActions;u(".multicommerce-info-recommended-action-button,.reset-all").click(s);var c=e.Widget_Accordion;p.on("change",".teg-accordion-title input",c);var d=e.Widget_Change;p.on("widget-added widget-updated panelsopen",d)},Ready:function(){var e=l,t=e.Snipits;e.Repeater(),t.Variables(),t.Append_HTML(),t.Color_Picker(u(".multicommerce-color-picker")),e.Click()},Load:function(){},Resize:function(){},Scroll:function(){},Init:function(){var e=l,t=e.Ready,i=e.Load,n=e.Resize,a=e.Scroll;u(document).ready(t),u(window).load(i),u(window).scroll(a),u(window).resize(n)}}).Init()}(jQuery);